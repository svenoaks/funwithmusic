package com.smp.funwithmusic.apiclient;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import android.util.Log;

import com.loopj.android.http.AsyncHttpClient;
import com.loopj.android.http.AsyncHttpResponseHandler;
import com.loopj.android.http.JsonHttpResponseHandler;
import com.loopj.android.http.RequestParams;
import com.smp.funwithmusic.utilities.URLParamEncoder;

public class ItunesClient
{
	private static final String BASE_URL = "http://itunes.apple.com/search?media=music&attribute=albumTerm&";

	private static AsyncHttpClient client = new AsyncHttpClient();

	public static void get(String album, JsonHttpResponseHandler responseHandler)
	{
		RequestParams params = new RequestParams();
		//params.put("term", URLParamEncoder.encode(album));
		//params.put("media", "music");
		//params.put("attribute", "albumTerm");
		Log.i("URL",  URLParamEncoder.encode(album));
		client.get(BASE_URL + URLParamEncoder.encode(album), responseHandler);
	}

	public static String getImageUrl(JSONObject json, String artist)
	{
		String result = null;
		JSONArray results;

		try
		{
			results = json.getJSONArray("results");

			for (int i = 0; i < results.length(); ++i)
			{
				JSONObject res = results.getJSONObject(i);
				String candidate = res.optString("artistName");
				if (artist != null && artist.toUpperCase().equals(candidate.toUpperCase()))
				{
					result = res.optString("artworkUrl100");
				}
			}
		}
		catch (JSONException e)
		{
			e.printStackTrace();
		}

		return result;
	}
}
